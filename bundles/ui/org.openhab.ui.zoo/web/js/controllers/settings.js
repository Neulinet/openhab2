// Generated by CoffeeScript 1.9.2
'use strict';
angular.module('ZooLib.controllers.settings', []).controller('SettingsController', function($scope, $log, discoveryService, discoveryResultRepository, inboxService, $stateParams) {
  this.scanResults = [];
  this.approveData = [];
  this.discoverableBindings = [];
  this.scan = function() {
    return inboxService.scan();
  };
  this.approve = function(thingUID) {
    var label;
    label = this.approveData[thingUID].label;
    return inboxService.approve({
      thingUID: thingUID
    }, label, function(arg) {
      $log.info("Approved " + thingUID, arg);
      return this.updateScanResults();
    });
  };
  this.ignore = function(thing) {
    return $log.warn('Not implemented, should ignore ', thing, this.thingToApprove);
  };
  this.updateScanResults = function() {
    return discoveryResultRepository.getAll(function(data) {
      var i, len, results, thing;
      $log.info(data);
      this.scanResults = data;
      this.approveData = [];
      results = [];
      for (i = 0, len = data.length; i < len; i++) {
        thing = data[i];
        results.push(this.approveData[thing.thingUID] = angular.copy(thing));
      }
      return results;
    }, function(err) {
      return $log.error('Error on fetching inbox', err);
    });
  };
  this.updateDiscoverableBindings = function() {
    return discoveryService.getAll(function(bindings) {
      return this.discoverableBindings = bindings;
    });
  };
  this.updateDiscoverableBindings();
  this.updateScanResults();
});
